---
import { getOgData } from '../../utils/getOgData';

export interface Props {
	url: string;
	title?: string;
}

function getDomain(url: string): string {
	try {
		const urlObj = new URL(url);
		return urlObj.hostname.replace(/^www\./, '');
	} catch {
		return url;
	}
}

function getFaviconUrl(domain: string): string {
	return `https://www.google.com/s2/favicons?domain=${domain}&sz=32`;
}

const { url, title: providedTitle } = Astro.props;

const ogData = await getOgData(url);
const title = providedTitle || ogData.title || url;
const ogImageUrl = ogData.image;
const domain = getDomain(url);
const faviconUrl = getFaviconUrl(domain);
---

<div class="flex flex-row justify-stretch items-stretch w-full rounded-xl h-24 bg-app-bg">
  <div class="flex flex-col self-stretch p-6 flex-1 justify-between min-w-0">
      <h2 class="text-base font-bold text-app-text truncate">
        <a href={url} target="_blank" rel="noopener noreferrer">{title}</a>
      </h2>
      <div class="flex flex-row items-center gap-2.5">
		<img
			src={faviconUrl}
			alt=""
			class="w-4 h-4"
			loading="lazy"
		/>
      <span class="text-xs font-medium text-app-text-subtle">
			{domain}
      </span>
  </div>
  </div>
  {ogImageUrl && (
    <div class="flex flex-row justify-end items-center h-full flex-shrink-0">
        <img
          src={ogImageUrl}
          alt={title}
          class="w-24 h-24 md:w-[168px] md:h-24 rounded-r-xl object-cover"
        />
    </div>
  )}
</div>
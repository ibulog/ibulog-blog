---
title: "kindã‚’ZFSä¸Šã§åˆ©ç”¨ã™ã‚‹å ´åˆã¯ãŠã¾ã˜ãªã„ãŒå¿…è¦ãªã‚“ã§ã™"
description: "ãƒ­ãƒ¼ã‚«ãƒ«ã§k8sã‚¯ãƒ©ã‚¹ã‚¿ã‚’å±•é–‹ã§ãã‚‹kindã‚’ã€ZFSä¸Šã§åˆ©ç”¨ã™ã‚‹å ´åˆã®æ³¨æ„ç‚¹ã‚’èª¬æ˜ã—ã¾ã™ã€‚"
pubDate: "2020/12/16"
tags: ["Linux", "Infrastracture"]
---

ãƒ­ãƒ¼ã‚«ãƒ«ã«Kubernetesã‚¯ãƒ©ã‚¹ã‚¿ã‚’ãŠæ‰‹è»½ã«æ§‹ç¯‰ã§ãã‚‹ã®ãŒã€Œkindã€ã•ã‚“ã§ã™ã€‚ã€ŒKubernetes in Dockerã€ã§kindã€‚

ä»•çµ„ã¿ã¨ã—ã¦ã¯Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’Nodeã¨ã—ã€ãã®ä¸­ã«Podã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã¿ãŸã„ã€‚Dockerã¨kubectlãŒã‚ã‚Œã°å‹•ãã¾ã™ã€‚

ã²ã‚‡ã‚“ãªã“ã¨ã§åˆ©ç”¨ã™ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã™ãŒã€ã©ãƒ¼ã‚‚ã†ã¡ã®ç’°å¢ƒã§ã¯Control Planeã®èµ·å‹•ã«å¤±æ•—ã™ã‚‹ã‚ˆã†ã§â€¦

èª¿ã¹ã¦ã¿ã‚‹ã¨ãŠã¾ã˜ãªã„ãŒå¿…è¦ã ã£ãŸã®ã§ã€å‚™å¿˜éŒ²ã€‚

## rootãƒ‡ã‚£ã‚¹ã‚¯ãŒZFSã ã¨ãªã‚“ã‹ãƒ€ãƒ¡ã¿ãŸã„

### ã¨ã‚Šã‚ãˆãšã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚°ã‚°ã‚‹

OSã¯Ubuntu 20.04ã€‚VirtualBoxã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸUbuntuã§ã¯Control Planeã®èµ·å‹•ã«æˆåŠŸã™ã‚‹ã®ã«ã€ãƒ™ã‚¢ãƒ¡ã‚¿ãƒ«ã§å®Ÿè¡Œã—ãŸå ´åˆã¯ãªãœã‹å¤±æ•—ã™ã‚‹â€¦

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ¤œç´¢ã™ã‚‹ã¨ã€åŒã˜ã‚¨ãƒ©ãƒ¼ã«æ‚©ã¾ã•ã‚Œã¦ã„ã‚‹äººã‚’ç™ºè¦‹ã€‚

[RROR: failed to create cluster: failed to init node with kubeadm Â· Issue #1437 Â· kubernetes-sigs/kind](https://github.com/kubernetes-sigs/kind/issues/1437)

ã“ã“ã«ã¯è§£æ±ºç­–ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€ãƒ’ãƒ³ãƒˆã‚’æ´ã‚€ã“ã¨ã¯ã§ãã¾ã—ãŸã€‚

>using a filesystem that doesn't work out of the box with docker in docker #1416 (comment

Dockerã‚³ãƒ³ãƒ†ãƒŠã®ä¸­ã§Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’å‹•ã‹ã›ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒå­˜åœ¨ã™ã‚‹â€¦ï¼Ÿ

### ZFSã¨btrfsã¯ã¡ã‚‡ã£ã¨å‰ã¾ã§kindã§å•é¡ŒãŒç”Ÿã˜ã¦ã„ãŸã‚‰ã—ã„

ã‚‚ã†å°‘ã—æ¢ã™ã¨ã€ä¸‹è¨˜ã®è¨˜äº‹ãŒãƒ’ãƒƒãƒˆã€‚

[Cannot create cluster in Arch Linux with ZFS Storage Driver Â· Issue #1121 Â· kubernetes-sigs/kind](https://github.com/kubernetes-sigs/kind/issues/1121)

ZFS/btrfsä¸Šã§Docker in Dockerã™ã‚‹ã¨ã€overlayfsã«å•é¡ŒãŒç”Ÿã˜ã‚‹ã‚‰ã—ã„ã€‚

ãŸã ã€ã€Œå•é¡Œã¯è§£æ±ºã—ãŸã€ã¨ã‚ã‚‹ã®ã§ã€ã‚‚ã†å°‘ã—èª¿ã¹ã¾ã™ã€‚

### ZFSã§ã‚‚kindã‚’ä½¿ãˆã‚‹è§£æ±ºç­–ã‚’ç™ºè¦‹

ä¸‹è¨˜ã®issueã«è§£æ±ºç­–ãŒã‚ã‚Šã¾ã—ãŸã€‚

[Create cluster fails - kind-control-plane does not work on zfs Â· Issue #1719 Â· kubernetes-sigs/kind](https://github.com/kubernetes-sigs/kind/issues/1719)

å…·ä½“çš„ã«ã¯ã€kindå®Ÿè¡Œæ™‚ã«æŒ‡å®šã™ã‚‹configãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã°OKã€‚

```
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
containerdConfigPatches:
- |-
Â [plugins."io.containerd.grpc.v1.cri".containerd]
Â snapshotter = "native"
```

ã‚­ãƒ¢ã¯`snapshotter = "native"`ã§ã€ZFSã‚’ä½¿ã£ã¦snapshotã‚’å–ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ç‚¹ã€‚

ã“ã‚Œã‚’æŒ‡å®šã—ãªã„ã¨snapshotã‚’å–å¾—ã™ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«overlayfsãŒä½¿ã‚ã‚Œã¦ã—ã¾ã„å•é¡ŒãŒç™ºç”Ÿã™ã‚‹æ¨¡æ§˜ã€‚

microk8sã§ã‚‚åŒã˜å•é¡ŒãŒèµ·ã“ã£ã¦ã„ã¦ã€ã“ã¡ã‚‰ãŒå…ˆã«ä¿®æ­£ã•ã‚Œã¦ã„ãŸã‚ˆã†ã§ã™ã€‚

[Use native containerd snapshotter for ZFS (#1000) Â· canonical/microk8s@a5ec1f9](https://github.com/canonical/microk8s/commit/a5ec1f9540dbc6500e39dbdf30c79027f8e99239#diff-e263cbd0de8da1f880f701684ae8b035R35-R36)

## ç„¡äº‹å‹•ã„ãŸ

`kind create cluster --config config.yaml`ã§å…ˆã»ã©ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ã¨ã€ç„¡äº‹Control PlaneãŒèµ·å‹•ã—ã¦Clusterã‚’æ§‹ç¯‰ã§ãã¾ã—ãŸã€‚

ã‚ã§ãŸã—ã‚ã§ãŸã—ã€‚

### P.S.

æœ€è¿‘çŸ¥ã£ãŸLinuxã®ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã€ŒUlauncherã€ã€ã‹ãªã‚Šã‚ˆã„ã€‚

[Ulauncher â€” Application launcher for Linux ğŸ§](https://ulauncher.io/)

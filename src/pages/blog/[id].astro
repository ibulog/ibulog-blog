---
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import MarkdownPostLayout from "../../layouts/MarkdownPostLayout.astro";
import sortArticleByDate from "../../utils/sortArticleByDate.ts";
import CodeBlock from "../../components/CodeBlock.astro";
import H2 from "../../components/ui/H2.astro";
import H3 from "../../components/ui/H3.astro";
import H4 from "../../components/ui/H4.astro";
import Text from "../../components/ui/Text.astro";
import Quote from "../../components/ui/Quote.astro";
import ArticleImage from "../../components/ui/ArticleImage.astro";
import LinkCard from "../../components/ui/LinkCard.astro";
import ArticleLink from "../../components/ui/ArticleLink.astro";
import InlineCode from "../../components/ui/InlineCode.astro";

type Props = {
  entry: CollectionEntry<"blog">;
  prevArticle?: CollectionEntry<"blog">;
  nextArticle?: CollectionEntry<"blog">;
};

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  const articleNumber = blogEntries.length;

  return blogEntries.sort(sortArticleByDate).map((entry, i) => ({
    params: { id: entry.id },
    props: {
      entry,
      prevArticle: i === 0 ? undefined : blogEntries[i - 1],
      nextArticle: i + 1 === articleNumber ? undefined : blogEntries[i + 1],
    },
  }));
}

const { entry, prevArticle, nextArticle } = Astro.props;
const { Content } = await render(entry);

const pageKind = 'Blog'
---

<BaseLayout title={entry.data.title} description={entry.data.description} url={`/blog/${entry.id}`} image={entry.data.heroImage as any} pageKind={pageKind}>
  <MarkdownPostLayout
    entry={entry}
    prevArticle={prevArticle}
    nextArticle={nextArticle}
  >
    <Content components={{ "code-block": CodeBlock, "h2": H2, "h3": H3, "h4": H4, "p": Text, "blockquote": Quote, "img": ArticleImage, "link-card": LinkCard, "a": ArticleLink, "code": InlineCode }} />
  </MarkdownPostLayout>
</BaseLayout>
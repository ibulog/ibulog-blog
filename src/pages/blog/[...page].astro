---
import type { GetStaticPathsOptions, Page } from "astro";
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";

import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleListSection from '../../layouts/ArticleListSection.astro';
import sortArticleByDate from "../../utils/sortArticleByDate";
import { SITE_TITLE, SITE_DESCRIPTION, ICON_IMAGE, PAGE_KINDS } from '../../config';

type Props = {
  page: Page<CollectionEntry<'blog'>>;
};

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allPosts = await getCollection('blog');
  const allPostsSorted = allPosts.sort(sortArticleByDate)
  return paginate(allPostsSorted, { pageSize: 7 });
}

const { page } = Astro.props
const { currentPage, lastPage } = page
const pageKind = PAGE_KINDS.BLOG;
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION} url="/blog" image={ICON_IMAGE} pageKind={pageKind}>
	<ArticleListSection 
		entries={page.data} 
		showPagination={true} 
		pagination={{ currentPage, lastPage, page }} 
	/>
</BaseLayout>